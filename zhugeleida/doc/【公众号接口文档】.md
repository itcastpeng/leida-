
[TOC]



####  1.1、【公众号 - 实时聊天-发送消息接口】

请求方式：POST（HTTP）

请求示例

>http://127.0.0.1:8000/zhugeleida/gongzhonghao/chat/send_msg/0?rand_str=8bd0ac475c5c60e46a358b3e6bcc49cf&timestamp=1537514281502&user_id=1

 GET 请求参数部分：
```  python
{
    'rand_str': account.str_encrypt(timestamp + token),
    'timestamp': timestamp,
    'user_id': 2,
}
``` 

 
POST 请求参数部分：
```  python
参数             必填        说明
customer_id      是         公众号客户ID
u_id          是            雷达用户ID
content        是        内容 

content = {
    'info_type' :  1 , # 1代表发送的文字\表情\ 或 话术库里的自定义(文字表情)。
    'msg': '这个信息是文字\表情'
}

content = {
    'info_type' : 2 , # 2代表发送的产品咨询  3代表发送的电话号码  4代表发送的图片|截图  5、视频
    'product_cover_url': 'statics/zhugeleida/imgs/chat/2d49ecd2-9180-11e8-a32d-8e2edea1cc9c.png',
    'product_name': '产品名字',
    'product_price': '产品价格',
}
content = {
    'info_type' : 3   ,   # 3代表客户要触发事件要电话号码  
    'msg': '您好,请问能否告诉我您的手机号?|您好,请问能否加下您的微信?'
    ......
}

send_type =    2     |   发送类型，2 代表 公众号客户发送给用户。
``` 
`` 
 


返回结果：
```  python
{"code": 200, "msg": "send msg successful", "data": {}}
``` 
 


####  1.2、 【 公众号 - 时聊天-获取最新的聊天信息】

请求方式：GET（HTTP）
请求示例:

>http://127.0.0.1:8000/zhugeleida/gongzhonghao/chat/getmsg/0?rand_str=b223adf172e809f5b91d2b6864788045&timestamp=1537514484951&user_id=1&u_id=1
 
 
GET 请求参数部分：

```  python
{
    'rand_str': account.str_encrypt(timestamp + token),
    'timestamp': timestamp,
    'user_id': 2,
    'u_id':  1   # 雷达用户ID
}

``` 

GET请求参数部分：

```  python
参数            必填          说明
u_id            是           要发给的雷达用户ID
user_id         是           公众号客户的ID

``` 

 返回结果：

```  python
{
    "code":200,
    "msg":"实时获取-最新聊天信息成功",
    "data":{
        "ret_data":[
            {
                "customer_id":1,
                "user_id":1,
                "user_avator":"http://shp.qpic.cn/bizmp/prSBf5AvHhAV3730YB9qjpC4Uicv4pA4JBkjhgJmjzZSBB5vSC1gmrA/",
                "customer_headimgurl":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83epcPbQBxqzSu2qXqWuCrodTSbvlBmqJuOF1OIuMp46k9SSUvCCWZCF8Nj28TCe17NwoAib2lq14bAA/132",
                "customer":"_zzz จุ๊บ",
                "dateTime":"2018-09-21T15:18:01.548",
                "send_type":2,
                "is_first_info":false,
                "info_type":1,
                "msg":"这个信息是文字\表情"
            }
        ],
        "data_count":1
    }
}
``` 


####  1.3、【公众号 - 分页获取-所有的聊天信息记录】

请求方式：GET（HTTP）
请求示例：

>http://127.0.0.1:8000/zhugeleida/gongzhonghao/chat?rand_str=53444e4ca12d03176c9b6109c0c557b0&timestamp=1528871213546&user_id=1&customer_id=1

GET 请求参数部分：

``` python
{
    'rand_str': account.str_encrypt(timestamp + token),
    'timestamp': timestamp,
    'u_id': 2,   
    'customer_id': 1,
    'current_page'：1,            
    'length'     :   20           
}

```

GET参数说明:

``` python
参数           必填          说明
u_id           是           用户的ID
customer_id    是           客户的ID

length         否           每页长度
current_page   否           当前页数

```

返回结果：

```  python
{
    "code":200,
    "msg":"分页获取-全部聊天消息成功",
    "data":{
        "ret_data":[
            {
                "customer_id":1,
                "from_user_name":"_zzz จุ๊บ",
                "user_id":1,
                "customer":"_zzz จุ๊บ",
                "user_avatar":"http://shp.qpic.cn/bizmp/prSBf5AvHhAV3730YB9qjpC4Uicv4pA4JBkjhgJmjzZSBB5vSC1gmrA/",
                "customer_headimgurl":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83epcPbQBxqzSu2qXqWuCrodTSbvlBmqJuOF1OIuMp46k9SSUvCCWZCF8Nj28TCe17NwoAib2lq14bAA/132",
                "dateTime":"2018-09-21T15:18:01.548",
                "send_type":2,
                "is_first_info":true,
                "info_type":1,
                "msg":"这个信息是文字\表情"
            }
        ],
        "mingpian_phone":"18932674288",
        "wechat":"18866554433",
        "data_count":1
    }
}
``` 



####   1.4、【 公众号 - 聊天 - 获取聊天数量】
请求方式：GET（HTTP）
请求示例:

>http://127.0.0.1:8000/zhugeleida/gongzhonghao/chat/query_num/0?rand_str=fda21c3109b2a3fec924da3c6f1e4d29&timestamp=1534407372677&user_id=9&u_id=1

 
 
GET 请求参数部分：

```  python
{
    'rand_str': account.str_encrypt(timestamp + token),
    'timestamp': timestamp,
    'u_id': 1,
    'user_id': 9
}

``` 

GET请求参数部分：

```  python
参数            必填         说明
u_id            是           所属用户的ID
user_id         是           用户ID
``` 

 返回结果：

```  python
{
   {
    "code":200,
    "msg":"查询成功",
    "data":{
        "chatinfo_count":1
    }
}
    
``` 
